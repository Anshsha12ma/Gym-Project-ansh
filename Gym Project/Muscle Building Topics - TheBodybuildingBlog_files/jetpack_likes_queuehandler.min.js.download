var jetpackLikesWidgetBatch=[],jetpackLikesMasterReady=!1,jetpackLikesLookAhead=2e3,jetpackCommentLikesLoadedWidgets=[],jetpackLikesDocReadyPromise=new Promise(a=>{document.readyState!=='loading'?a():window.addEventListener('DOMContentLoaded',()=>a())}),jetpackWidgetsDelayedExec,jetpackOnScrollStopped;function JetpackLikesPostMessage(a,b){if(typeof a=='string')try{a=JSON.parse(a)}catch(a){return}if(b&&typeof b.postMessage=='function')try{b.postMessage(JSON.stringify({type:'likesMessage',data:a}),'*')}catch(a){return}}function JetpackLikesBatchHandler(){const a=[];document.querySelectorAll('div.jetpack-likes-widget-unloaded').forEach(c=>{if(jetpackLikesWidgetBatch.indexOf(c.id)>-1)return;if(!jetpackIsScrolledIntoView(c))return;jetpackLikesWidgetBatch.push(c.id);var e=/like-(post|comment)-wrapper-(\d+)-(\d+)-(\w+)/,b=e.exec(c.id),d;if(!b||b.length!==5)return;d={blog_id:b[2],width:c.width},'post'===b[1]?d.post_id=b[3]:'comment'===b[1]&&(d.comment_id=b[3]),d.obj_id=b[4],a.push(d)}),a.length>0&&JetpackLikesPostMessage({event:'initialBatch',requests:a},window.frames['likes-master'])}function JetpackLikesMessageListener(c){let b=c&&c.data;if(typeof b=='string')try{b=JSON.parse(b)}catch(a){return}const d=b&&b.type,a=b&&b.data;if(d!=='likesMessage'||typeof a.event=='undefined')return;const e='https://widgets.wp.com';if(e!==c.origin)return;switch(a.event){case'masterReady':jetpackLikesDocReadyPromise.then(()=>{jetpackLikesMasterReady=!0;const c={event:'injectStyles'},d=document.querySelector('.sd-text-color'),e=document.querySelector('.sd-link-color'),a=d&&getComputedStyle(d)||{},b=e&&getComputedStyle(e)||{};document.body.classList.contains('single')&&JetpackLikesPostMessage({event:'reblogsEnabled'},window.frames['likes-master']),c.textStyles={color:a.color,fontFamily:a['font-family'],fontSize:a['font-size'],direction:a.direction,fontWeight:a['font-weight'],fontStyle:a['font-style'],textDecoration:a['text-decoration']},c.linkStyles={color:b.color,fontFamily:b['font-family'],fontSize:b['font-size'],textDecoration:b['text-decoration'],fontWeight:b['font-weight'],fontStyle:b['font-style']},JetpackLikesPostMessage(c,window.frames['likes-master']),JetpackLikesBatchHandler()});break;case'showLikeWidget':{const b=document.querySelector(`#${a.id} .likes-widget-placeholder`);b&&(b.style.display='none');break}case'showCommentLikeWidget':{const b=document.querySelector(`#${a.id} .likes-widget-placeholder`);b&&(b.style.display='none');break}case'killCommentLikes':document.querySelectorAll('.jetpack-comment-likes-widget-wrapper').forEach(a=>a.remove());break;case'clickReblogFlair':wpcom_reblog&&typeof wpcom_reblog.toggle_reblog_box_flair=='function'&&wpcom_reblog.toggle_reblog_box_flair(a.obj_id);break;case'hideOtherGravatars':{hideLikersPopover();break}case'showOtherGravatars':{const b=document.querySelector('#likes-other-gravatars');if(!b)break;const c=b.classList.contains('wpl-new-layout'),d=b.querySelector('ul');b.style.display='none',d.innerHTML='',c?b.querySelectorAll('.likes-text span').forEach(b=>b.textContent=a.totalLikesLabel):b.querySelectorAll('.likes-text span').forEach(b=>b.textContent=a.total),(a.likers||[]).forEach(async(b,f)=>{if(b.profile_URL.substr(0,4)!=='http')return;const e=document.createElement('li');d.append(e),c?e.innerHTML=`
					<a href="${encodeURI(b.profile_URL)}" rel="nofollow" target="_parent" class="wpl-liker">
						<img src="${encodeURI(b.avatar_URL)}"
							alt=""
							style="width: 28px; height: 28px;" />
						<span></span>
					</a>
				`:e.innerHTML=`
					<a href="${encodeURI(b.profile_URL)}" rel="nofollow" target="_parent" class="wpl-liker">
						<img src="${encodeURI(b.avatar_URL)}"
							alt=""
							style="width: 30px; height: 30px; padding-right: 3px;" />
					</a>
				`,e.classList.add(b.css_class),e.querySelector('img').alt=a.avatarAltTitle.replace('%s',b.name),c&&(e.querySelector('span').innerText=b.name),f===a.likers.length-1&&e.addEventListener('keydown',b=>{b.key==='Tab'&&!b.shiftKey&&(b.preventDefault(),hideLikersPopover(),JetpackLikesPostMessage({event:'focusLikesCount',parent:a.parent},window.frames['likes-master']))})});const e=function(){const m=getComputedStyle(b),l=m.direction==='rtl',k=document.querySelector(`*[name='${a.parent}']`),h=k.getBoundingClientRect(),i=k.ownerDocument.defaultView,f={top:h.top+i.pageYOffset,left:h.left+i.pageXOffset};let e=0;if(c){if(b.style.top=f.top+a.position.top-1+'px',l){const c=a&&a.likers?Math.min(a.likers.length,5):0;e=f.left+a.position.left+24*c+4,b.style.transform='translateX(-100%)'}else e=f.left+a.position.left;b.style.left=e+'px'}else b.style.left=f.left+a.position.left-10+'px',b.style.top=f.top+a.position.top-33+'px';const n=a.width-20,g=Math.floor(n/37);let j=Math.ceil(a.likers.length/g)*37+17+22;if(j>204&&(j=204),!c){const a=g*37+13;b.style.height=j+'px',b.style.width=a+'px';const c=g*37;d.style.width=c+'px'}if(c){b.style.left='-9999px',b.style.display='block';const a=b.offsetWidth,c=e+a;c>i.innerWidth&&(e=h.right-a),b.style.left=e+'px'}else b.style.display='block';b.setAttribute('aria-hidden','false')};e(),b.focus();const g=function(b,c){var a;return function(){var d=this,e=arguments;clearTimeout(a),a=setTimeout(function(){b.apply(d,e)},c)}},f=g(e,100);b.__resizeHandler=f,window.addEventListener('resize',f),b.focus()}}}window.addEventListener('message',JetpackLikesMessageListener);function hideLikersPopover(){const a=document.querySelector('#likes-other-gravatars');if(a){a.style.display='none',a.setAttribute('aria-hidden','true');const b=a.__resizeHandler;b&&(window.removeEventListener('resize',b),delete a.__resizeHandler)}}document.addEventListener('click',hideLikersPopover);function JetpackLikesWidgetQueueHandler(){var a,b,c,d;if(!jetpackLikesMasterReady){setTimeout(JetpackLikesWidgetQueueHandler,500);return}jetpackUnloadScrolledOutWidgets(),b=jetpackGetUnloadedWidgetsInView(),b.length>0&&JetpackLikesBatchHandler();for(c=0,d=b.length;c<=d-1;c++){if(a=b[c].id,!a)continue;jetpackLoadLikeWidgetIframe(a)}}function jetpackLoadLikeWidgetIframe(c){if(typeof c=='undefined')return;const a=document.querySelector('#'+c);a.querySelectorAll('iframe').forEach(a=>a.remove());const b=a.querySelector('.likes-widget-placeholder');if(b&&b.classList.contains('post-likes-widget-placeholder')){const c=document.createElement('iframe');c.classList.add('post-likes-widget','jetpack-likes-widget'),c.name=a.dataset.name,c.src=a.dataset.src,c.height='55px',c.width='100%',c.frameBorder='0',c.scrolling='no',c.title=a.dataset.title,b.after(c)}if(b.classList.contains('comment-likes-widget-placeholder')){const b=document.createElement('iframe');b.class='comment-likes-widget-frame jetpack-likes-widget-frame',b.name=a.dataset.name,b.src=a.dataset.src,b.height='18px',b.width='100%',b.frameBorder='0',b.scrolling='no',a.querySelector('.comment-like-feedback').after(b),jetpackCommentLikesLoadedWidgets.push(b)}a.classList.remove('jetpack-likes-widget-unloaded'),a.classList.add('jetpack-likes-widget-loading'),a.querySelector('iframe').addEventListener('load',b=>{JetpackLikesPostMessage({event:'loadLikeWidget',name:b.target.name,width:b.target.width},window.frames['likes-master']),a.classList.remove('jetpack-likes-widget-loading'),a.classList.add('jetpack-likes-widget-loaded')})}function jetpackGetUnloadedWidgetsInView(){const a=document.querySelectorAll('div.jetpack-likes-widget-unloaded');return[...a].filter(a=>jetpackIsScrolledIntoView(a))}function jetpackIsScrolledIntoView(a){const b=a.getBoundingClientRect().top,c=a.getBoundingClientRect().bottom;return b+jetpackLikesLookAhead>=0&&c<=window.innerHeight+jetpackLikesLookAhead}function jetpackUnloadScrolledOutWidgets(){for(let b=jetpackCommentLikesLoadedWidgets.length-1;b>=0;b--){const a=jetpackCommentLikesLoadedWidgets[b];if(!jetpackIsScrolledIntoView(a)){const c=a&&a.parentElement&&a.parentElement.parentElement;c.classList.remove('jetpack-likes-widget-loaded'),c.classList.remove('jetpack-likes-widget-loading'),c.classList.add('jetpack-likes-widget-unloaded'),c.querySelectorAll('.comment-likes-widget-placeholder').forEach(a=>a.style.display='block'),jetpackCommentLikesLoadedWidgets.splice(b,1),a.remove()}}}jetpackWidgetsDelayedExec=function(b,c){var a;return function(){clearTimeout(a),a=setTimeout(c,b)}},jetpackOnScrollStopped=jetpackWidgetsDelayedExec(250,JetpackLikesWidgetQueueHandler),JetpackLikesWidgetQueueHandler(),window.addEventListener('scroll',jetpackOnScrollStopped,!0)